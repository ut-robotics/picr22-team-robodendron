== Team presentation
*Gautier Reynes:* in charge of Mechanics and Programming, support for Electronics. +
*Malcom  Radigon:* in charge of Programming. +
*Léon Glorieux:* in charge of Mechanics. +
*Nathan Mison:* in charge of Electronics. +

== Fusion 360 assembly link

https://a360.co/3D6WDk6 +

== Programming

*External libraries* +

numpy - Calculation and data processing +
math - Trigonometric functions +
enum - State of the robot +
pyserial - Serial communication +
websocket - Connect to the server of referee referee command +
json - access the data of referee command +
threading - Create thread for each action of the robot +
sys - Control thread +
pickle - Store the color configuration +
cv2 - image processing +
input/get_gamepad - communication with the gamepad controller +
pyrealsense2 - Realsense camera +

*Game logic* +
	
The robot starts when the referee sends the command with the target basket. It will rotate until it sees a ball. 
If it sees a ball, it drives towards it until it is close enough. Once it is close enough, it orbits around the ball until it is aligned with the ball and the target basket. 
It estimates the distance with the basket and engages the thrower motor accordingly. It goes forward to throw the ball. Then it starts again to search a ball by rotating.
If at any moment , the ball is lost then it rotates again to find a new one. +

This block diagram sums up the game logic: +

image::code_diagram.png[]

*Code structure* +

Here we'll briefly describe the code structure, since the game logic is established.+

The backbone of the code is the script *follow_ball_depth.py*. This is the "main" script that should be executed for the robot to move and play basketball. From this, an object from the OmniMotionRobot class contained in the *motion.py* script
is initiated. This object will be used to tackle the robots movement thanks to several methods associated with omnimotion movements. The *controller.py* script overwrites the instance of the omnimotion object and is used to control the robot
manually with a gamepad. The robot is able to see the balls and hoops thanks to a depth sensing camera, the camera is tackled by the *camera.py* script. Again, we create an object of camera which allows to grab camera frames which we use to detect balls and hoops.
But to extract the balls and hoops, we need some processing from the camera frames, the robot is not magically able to tell what is a ball, and what isn't. That's where the *image_processor.py* comes into play. We process the images
so that we can trace contours around balls, detecting the pixels with the right color. The vertices of the center of the balls is extracted so we know how to move the robot to go grab them. The same principle applies for the hoops, but we also take
the depth into account, since we want to determine the distance between the robot and the hoop, so that the throw is at the right speed to score. The color sensibility is taken care of with the *config_colors.py* script. Calibrating the detection for green, blue and magenta
helps at making the robot more accurate. Finally, the robot is not able to do anything unless it's told to, thanks to the referee commands, which are dealt with by the *referee_command.py* script.+

*Code review* +

The logic of the movement of the robots was good since the robot was moving with smooth trajectory towards the ball and the alignment with the baskets were smooth as well. The main improvement is in the machine vison part. The color detection and the depth estimation could be improved to get a better accuracy when aligning the ball and the basket so we can score more often. The robot got issues as well to detect the balls on the field when they were too far from the robot. This can as well be improved by adjusting the OpenCV part. The robot didn't have the logic to ignore the balls when they are outside of the field or to avoid the collision with the baskets. This cause a lot of penalty during competition, and this is something important to implement. This can be done as well by developing more the machine vision part. The logic to search the ball can be improve by making straight trajectory between the opponent basket the team basket. This would allow to find all the balls on the filed even if the last ball remaining is at the opposite side. +

== Mechanics

To design our mechanic, we started from what we had available. 
To find mechanical solutions, we had the teacher robot that we saw performing on the very first day, and we were given the Jordan robot chassis. 
We were also given CAD components such as the camera, and the Jordan robot complete design on fusion 360. +

The only thing we used that was not provided at the start was the grabcad 3D design of the servo and the brushless, so we don’t have to build them ourselves. For the rest, we built it all with the available resources. +

*Thrower design:* +

To build the thrower, we decided to develop it little by little to keep a functional component, and have a working prototype as soon as possible.
We started by building the static thrower, with a single ramp at 60°, the bottom at 5mm from the ground, and the brushless at 35mm from the ramp, and 40 mm to the ground to press the ball on the ramp. Since we were working with the Jordan robot, we adapted our fixation system to the former system. +

image::thrower1.png[]

Then we tried to make the thrower change angle. We decided to range from 50° to 70°, and used an arm with one of the extremities attached to the axis of the center of the brushless.
We faced a problem of size and torque at that time, since the micro servo was not strong enough to rotate the arm, and there was no space to place the servo, since there was a nozzle to guide the ball to the thrower. To solve the issue, we decided to use a sliding pin close to the extremity of the thrower, to place the servo, behind the thrower. That way we reduced the torque and found a place with enough space to place the servo. +

image::thrower2.png[]

The last part we implemented was the way to hold a ball in the thrower. We decided to do that with a roller connected to a servo. To implement that component, we needed to modify the original design of the ramp to add a first ramp where the ball holds before being fed to the thrower. At last we just connected the new thrower to the new chassis. +

image::thrower3.png[]

Here's a picture of our robot in its final state, with all the parts fully assembled. It's quite big as we had to play with
the test robot electronics. In a way, it's more practical since we have room to fit all the cables... We struggled with the
more compact test robot we had, so we figured we'd go big for our own. 

image::robot.jpg["The robot"]

*Overall review:* +
I think our overall design was quite good for launching the ball, the distance to the floor was adapted to collect the ball, the nozzle was big enough to lead the ball to the thrower in case of bad lining up. We didn’t take the full available space but kept enough to have some space to work. We designed pieces, so the ball doesn’t get stuck on the robot. The baseplate is at a good height so it doesn’t happen to hit the carpet, as well as the thrower lower parts. The overall structure also had a good rigidity.
We should have built something to cover the wheels in case of shock. The pin that connects the wheels to the motor can get damaged. The brushless gets full of hair from the carpet. +


== Electronics

The final electronics are the test electronics. The two servos on the thrower are not implemented in the code so there is no need for them to be linked to the mainboard. The pcb was not finished for multiples reasons, first assembling the test electronics took longer than expected because the test robot we had was very small and not adapted for the test electronics, it was made for a pcb. Then the mainboard and the voltage regulator were short circuited, had to be replaced reprogrammed and refitted on the test robot leading to a month of delay. Finally, I also learned how to design a pcb while making it, leading to some mistakes in designing that cost time that I no longer had. +

The PCB was not finished in time, but even so there was nothing to connect the two servos on the thrower, so adding the connections would have been better. We also noticed that having a larger robot makes fitting the test electronics in it much easier. With the test robot we really struggled as it was very small, but our new robot it was much smoother. +

As can be seen on this picture, thanks to spacious design of the robot, there is ample room for all the components and the cable management is clean. This is also helped thanks to connectors of the battery being embedded in the design and not dangling everywhere. +

image::cabling.jpg[]


== Personal comments

*Gautier:* I personally worked on the robot's chassis (base chassis, camera mounts, anything that holds
the robot's parts together...) and the omniwheels, as well as some of the software (gamepad control, vision logic... I gave Malcom
some support with depth sensing for the robot's aim at the hoops...).
This project requires good skills in any topic of mechatronics, and depending on how you manage your team,
and depending on how much your teammates want to be involved, it can go south pretty easily. Deadlines aren't short
you get the sufficient amount of time to get things done, but falling in the trap of wasting crucial time on useless things
is so easy... +

The TAs are very demanding, so you should be very flexible with your solutions, and anticipate all
tiny attention mistakes in either your code, your CAD and electronics. Some details might seem like a pain, but most of the time
it's all about best practices for later work in the industry I guess. +

All in all, it was a stressful yet interesting project. I appreciate the ressources the University makes available for our work, never before was I able to work with such
machinery and materials accessible 24/7. My regrets are the miscommunications with some of the TAs and the ambiguity of some indications. This project's outcome was heavily dependent
on the test robot we got, and in our case it was really bad... +

*Malcom:* +

*my work* +
I did the programming part. The entire game logic of the robot. +

*What I learned* +
I learned about robot motion and vision. To code as best as possible the motion of an omnimotion robot. I learned about connecting to server using websocket. I learned that the way we structure the code from the beginning is really important for development. +

*Improvement for next time* +
I would first improve the way I structured the code at the beginning to not change it during the semester and to have it easy to understand. I would as well improve a lot the logic of the robot. Adding the logic to keep the robot in the field, to not collide with the opponent robot or with baskets. I would improve the color detection to get better overall accuracy. +

*What did you like/did not like about the course/building a robot?* +
I like the code given at the beginning that helps a lot to start the code. The boot camp was useful as well but if people already have a team, it is better to start working together from the boot camp. I didn't like all the constraints about the code. Sometimes we didn't know about a rule of coding and then finally we have to change a lot of the code to fit with it. +


*Suggestions for next year's students.* +
Check the deadline every week to be sure you are not late because no one will remind you about it. Work consistently all along even if you are ahead of time in the beginning. Submit all the tasks as soon as possible because you will have a lot of changes for each review. +

*Suggestions for instructors.* +
The point system may be improved. By making third place in the competition we all have bad grades. Be more flexible on the tasks and be consistent with the reviews.

*Léon:*

*my work:* +
-mechanics +
- thrower complete design +
- motor mounts +
- helped on the omni wheels and the camera mount +
- manufacturing process on fusion and the machines +
- found technical solutions along with Gautier Reynes and the professors.  +
- physical calibration of the parameters. +
- presentations. +
- assemble the robot. +

*Learning experience:* +
New mechanical methods. +
Fusion 360, 3D modeling and manufacturing
milling machine +
work method for 3D modeling +
A team needs a leader from the start. +
The Agile method is a necessity for this type of work. +

*Improvement for next time:* +
Better awareness of the deadline, by putting them on paper from the start. More team meetings to know exactly where everyone is in their work. +





*Opinion on the course:* +

Great to have a 24/7 access card to be able to work freely. Lots of tools we could use. 
I didn’t like that I spent weeks on reviews. I corrected the review and then there were new things to correct on the next review everytime, even for things that had remained untouched from the start. But of course reviews were helpful for improving the design.
Too much attention on some details, to not validate points for the whole team is discouraging when the work was globally finished long before the due date.
The course was a very good opportunity to get hands-on experience. 
In the end we all had the same robot more or less. When I signed up, I really thought that we would get a chance to all build something we designed ourselves from scratch. +

*Suggestion for next year:* +
Start by choosing a leader, and put the deadline on a schedule. +
work consistently+

*For the teachers:* +
You are very capable, but I felt very little empathy and flexibility. We are humans, not machines. +


*Nathan:* I worked on the electronics, I therefore mostly learned how to design a pcb. Unfortunately, most of the mistakes chere either out of my control, like the test robot being to small or the mainboard shortcircuiting for no apparent reason. But since I now know how to design a pcb if I were to do the same thing again it would probably work.
I liked being able to work manually on the robot. I however disliked the lack of instructions on how to design teh pcb. I felt like both learning how to do it and doing it at the same time led to a very tight schedule. I had the impression that this course is not for learning but for doing something that is already learned, which is a shame.
For next year students I definetly advise to choose the largest robot at the beginning of the year as it leads to a much easier time fixing the test electronics. I would also recommend them to design their own robot with the test electronics in mind, so that no team the year after suffers from haing unfixable test electronics to the robot.
And for the instructors I would like more documentation on altium and how to design the pcb for this application, I think this would both accelerate the progression curve of people learning how to design pcbs. It would also probably lower the workload on the instructors as a part of the solicitation would be solved by the sudents themselves.
I also think that the fixed points awarded for each task does not adequatly reflect the workload. For example attaching the test electronics gives the same amount to everyone, but a team starting with a large robot and clean electronics has a much easier time doing this that one starting with a small robot and cabling that has to be done over again. +

== Blog

== Saturday 2022-09-03

Day 1 of project bootcamp. The whole team was familiarizing with the project's
structure and started working with other contestants than Robodendron's members.

Some worked on electronics while others played with mechanics and software.

== Sunday 2022-09-04

Day 2 of the project's bootcamp. The tasks were swapped between electronics, mechanics
and software development so that the whole team members could be introduced to the
concepts to be used in this project.

=== Monday 2022-09-05
Decide the tasks all together +
*Malcom:* start working on camera to find the ball (2h) +
*Leon:* start working on the test robot and get the sizes with the calliper, start thinking about a first launcher (2h) +
*Nathan:* soldering of missing parts from the test robot (2h) +
*Gautier:* started designing the ramp for the thrower with right ejection angle. (2h) +

=== Thursday 2022-09-08
*Malcom:* work on the omni wheels, to make them rotate (2h) +
*Leon:* build the thrower and get used to fusion (2h) +
*Nathan:* finished the soldering, improved some of the connections, tried to make the motors work (2h) +
*Gautier:* More tweaking on the thrower ramp (2h) +


=== Monday 2022-09-12
*Malcom:* work on the mapping of the omniwheels to give a direction, and start the programation of the motion (2h) +
*Leon:* finish the launcher (2h) +
*Nathan:* the motors worked it was due to some cabling error (2h) +
*Gautier:* final work on the ramp design with real test robot CAD (2h) +

=== Thursday 2022-09-15
...

=== Monday 2022-09-19
Progress presentation.

== Thursday 2022-09-22
*Malcom:*
*Leon:* Design of a new fixture component to attach the new omniwheels to the
motor axles. This new design should be much easier to attach to the wheel and 
it should grip the motor axles much better. (2h) +
*Nathan:* Cable management on the test robot. (2h) +
*Gautier:* Design of the new omniwheels (one single piece should be enough as
opposed to the two parts taking the bearings and their axles in "sandwich"). (2h) +

== Monday 2022-09-26
*Malcom:* Writing a code to spin the robot and stop when the ball is detected (2h) +
*Leon:*  Improvements on the thrower's structure with standoffs. The whole assembly should be much more rigid. (3h) +
*Nathan:*  Fixed the motor controllers to the frame (1h); started learning about PCB design (1h30) +
*Gautier:* Print of wheel prototypes to figure out the best tolerance settings for press fitting the roller axles. (3h) +

== Thursday 2022-09-29
*Malcom:* Writing a code that not only looks for the ball by spinning, but also moves the robot
towards the ball with a speed proportional to the distance to the target. (2h) +
*Leon:* Improvement ont the thrower (tolerances, holes...) (3h) +
*Nathan:* Continued learning about PCBs and searched some components (2h30) +
*Gautier:* Design, 3D printing and installation of the new omniwheel on the test robot.
Some heated inserts are installed to provide better fixture. Two designs for wheel hubs (fixture to the motor shafts) were
also attempted. A new single-piece design was born from issues with two-part hub/wheel. (6h30) +

== Monday 2022-10-3
Progress presentation. +
*Gautier:* Print of the latest omniwheel design integrating both the wheel and the hub in one piece. (2h) +

*Nathan:* Did Pcb footprint library of the mainboard (2h) +

== Thursday 2022-10-6
*Nathan:* Did Pcb schematics library of the mainboard (2h) +

== Monday 2022-10-10
*Leon:* Thinking about a way to modify the launcher to enable throwing angle adjustment. (1,5h) +
*Nathan:* Tried to join both schematics and footprint (2h) +

== Thursday 2022-10-13
*Leon:* 3D modelling of the adjustable solution. (3h) +
*Nathan:* Found some schematics libraries (2h) +

== Sunday 2022-10-16
*Gautier:* 3D printing parts of the fixed angle thrower + assembly of the new omniwheels. (3h) +

== Monday 2022-10-17
Progress presentation +

== Thursday 2022-10-20
*Nathan:* Electronics tests with thrower: burned mainboard (2h) +
*Léon:* work on the thrower motorisation (3h) +


== Monday 2022-10-24
*Nathan:* Tried to find mainboard problem (4h) +
*Léon:* add new features to the thrower, (2h) and thrower motorisation (1h) +
*Gautier:* first (unsuccessful) attempt at soldering the SMD jumper resistors on the new MCU (2h) +

Tuesday 2022-10-25
*Gautier:* The new MCU is ready, the solders are working although they don't look too preety (2h) +
== Thursday 2022-10-27
*Nathan:* Fixed problem, noticed voltage regulator was burned too (2h) +
*Léon:* setup and send review notice on the elements which are almost finished. Do the excel for the progress. +

== Monday 2022-10-31
Progress presentation+

*Léon:* correct the problems of the reviewed design, and discussion on the bad mechanical designs (3h) +
*Gautier:* starting designing the chassis's base plate (2,5h) +

== Thursday 2022-11-3
*Léon:* work on the redesign of the thrower (3h) +
*Nathan:* Made the voltage regulator work, created some new cables (2h) +
*Malcom:* connecting the robot back after the problem encountered. (2h) +
*Gautier:* work on chassis + help on the test robot (3h) +

== Monday 2022-11-7

*Gautier:* Design of the new robot's chassis (Central Unit mount, camera mount, battery mount...) (3.5h);
fixing the test robot (electronics, cable management...) for evaluation (4h) +
*Nathan:* Fixing the robot (electronics, cable management...) for evaluation (3h) +
*Malcom:* working on the code to align the robot with the ball and the target basket (3h) +
*Léon:* work on the redesign of the thrower and start to standardise all the CAD files I made (4h) +

== Wednesday 2022-11-9
*Gautier:* More work on the new chassis' battery and alarm mounts + XT60 sockets (3h) +
*Malcom:* Setting the thrower to aim at the basket(3h) +

== Thursday 2022-11-10
Test competition +

*Léon:* Standardization of CAD parts (2h) +
*Gautier:* Prep work and last minute fixes on test robot for test competition (3h)+
*Malcom:* Software tweaks and preparation of the robot for test competition (3h) +
*Nathan:* Worked on Altium (3h) +

== Monday 2022-11-14
Progress presentation +

== Tuesday 2022-11-15
*Gautier:* work on the chassis (side walls, camera mount improvements...) (4h) +

== Thursday 2022-11-17

*Nathan:* Finished all pieces (2h) +
*Léon:* redo all the badly made parts of the thrower (4h) +
*Malcom:*
*Gautier:* Absent +

== Monday 2022-11-21

*Nathan:* Finished schematics and tried to convert to pcb (3h) +
*Léon:* Finishing the renew of the thrower, 
improve the elements according to the feedback of the past presentation 
and build the system for the ball blocking system (4h) +
*Malcom:*
*Gautier:* Work on the chassis (1h) and review of the code with Malcom (2h) +

== Thursday 24-11-24
Test Competition 2 : The robot wasn't ready to receive referee commands so we bailed +
*Nathan:* Solved some problems (2h) +


== Saturday 2022-11-26

*Léon:* correct the small problems given in the review, and find solutions for the bigger ones. (2h) +

== Monday 2022-11-28
Progress presentation +

*Gautier:* Fixed the issues flagged after review. Improved the chassis (5h) +

== Thursday 2022-12-01
*Léon:* work on details of the CAD to get approval for milling, and start manufacturing on fusion(4h) +
*Malcom:* smooth the movement of the robot (4h) +
*Nathan:* finished schematics (3h) +
*Gautier:* XBOX controller support code (4h) +

== Monday 2022-12-05
*Léon:* change the whole assembly into a manufacturing model for the milling machine (3h) +
*Malcom:*improve the estimation of the distance (3h) +
*Nathan:* worked on pcb (4h) +
*Gautier:* Improvement of the distance estimation and thrower speed calculation + 3D printing chassis parts (3h)+

== Thursday 2022-12-08
*Léon:* Work on thrower accuracy, Milling and clean the components (9h) +
*Malcom:* get equation of the speed for the thrower (3h)+
*Nathan:*  tried to finish PCB (4h) +
*Gautier:* experimenting with thrower speed equation, implementation of depth sensing (3h) +

== Monday 2022-12-12
*Léon:* Assemble the components, make the threadings, print missing components (6h) +
*Nathan:* Assembly of the new robot (6h) +
*Gautier:* Assembly of the new robot (6h) +
*Malcom:* Assembly of the new robot (6h) +

